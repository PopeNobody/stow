#!/usr/bin/perl
#! -*- perl -*- -p
eval 'exec perl -x -wS $0 ${1+"$@"}'
  if 0;

use strict;
use warnings;
use autodie qw(:all);
BEGIN {
  use FindBin qw($Bin);
  use lib "$Bin/../lib/perl";
  $|++;
  $\="\n"; $,=" "; $"=" ";
  $/="\n";
  use AutoLess;
};
use Data::Dumper;
$ENV{LANG}="C";

open(STDIN,"</dev/null");
open(STDIN,"dpkg -l|");
open(STDIN,"awk '/^[a-z][a-z]/ {print \$2}'|");
#open(STDIN,"sort -u|");
sub filter;
sub mkFilter(@);
*filter=mkFilter(@ARGV);
while(<STDIN>){
  chomp;
  my $arch;
  ($_,$arch)=split /:/;
  next unless filter;
  print;
};
sub mkFilter(@) {
  @_ = grep { length } @_;
  if(@_==0){
    return sub { 
      return 1;
    }
  } elsif ( @_==1 ) {
    my $qr = qr{$_[0]};
    return sub { m/$qr/ };
  } else {
    return mkFilter(join("|", @_));
  }
};
