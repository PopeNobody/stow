#!/usr/bin/perl
# vim: ts=2 sw=2 ft=perl
eval 'exec perl -x -wS $0 ${1+"$@"}'
  if 0;

use strict;
use warnings;
use FindBin qw($Bin $Script);
use lib "$Bin/../lib/perl";
$|++; $\="\n"; $,=" "; $"=" "; $/="\n";
use autodie qw(:all);
use Nobody::PP;
use Getopt::WonderBra;

sub version {
  print "$Script version 0.9.0";
};

sub help {
  print "usage: $Script -o{owner} -g{group} -m{mode} -- \@files";
};

our(%opts);
our(%spec);
$spec{o}=sub { $opts{o}=shift; return @_; };
$spec{g}=sub { $opts{g}=shift; return @_; };
$spec{m}=sub { $opts{m}=shift; return @_; };
@ARGV = getopt("o:g:m:",@ARGV);
while(($_=shift)ne'--'){
  die "expected dash" unless s{^-}{};
  die "expected [ogm]" unless defined $spec{$_};
  @ARGV=$spec{$_}->(@ARGV);
}

my @cmd=qw(install);
push(@cmd,'-d');
for(grep { defined($opts{$_}) } sort keys %opts){
  push(@cmd,'-'.$_,$opts{$_});
};
unshift(@cmd,"echo") unless -t 1;
exec @cmd, @ARGV;
