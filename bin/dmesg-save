#!/usr/bin/perl
#! -*- perl -*- -p
eval 'exec perl -x -wS $0 ${1+"$@"}'
  if 0;

use strict;
use warnings;
use autodie qw(:all);
BEGIN {
  use FindBin qw($Bin);
  use lib "$Bin/../lib/perl";
  $|++;
  $\="\n";
};
use Data::Dump qw(ddx dd ppx pp);
use Getopt::Wonderbra;

@ARGV = getopt("a",@ARGV);
ddt(\@ARGV);

my @lines = qx(dmesg);
my ($serdate) = map { split } qx(serdate);
my ($fn)= "/var/log/dmesg-$serdate.gz";
chomp(@lines);
open(STDOUT,"|gzip>$fn");
print for @lines;
close(STDOUT);
print STDERR "write dmesg output to $fn\n";
system("dmesg -c > /dev/null");
