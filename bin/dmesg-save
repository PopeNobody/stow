#!/usr/bin/perl
#! -*- perl -*- -p
eval 'exec perl -x -wS $0 ${1+"$@"}'
  if 0;

use strict;
use warnings;
use autodie qw(:all);
our ($VERSION) = join("-",qw ( 1 0 0 ));
BEGIN {
  use FindBin qw($Bin);
  use lib "$Bin/../lib/perl";
  $|++;
  $\="\n";
};
use Data::Dump qw(ddx dd ppx pp);
use Getopt::WonderBra;
sub version {
  print "version $VERSION";
}
sub help {
  print "usage: $0 [ -a ]";
  print "       -a: append to existing output";
  print "";
}
@ARGV = getopt("a",@ARGV);
ddx(\@ARGV);

my @lines = qx(dmesg);
my ($serdate) = map { split } qx(serdate);
my ($fn)= "/var/log/dmesg-$serdate.gz";
chomp(@lines);
open(STDOUT,"|gzip>$fn");
print for @lines;
close(STDOUT);
print STDERR "write dmesg output to $fn\n";
system("dmesg -c > /dev/null");
